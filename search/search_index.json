{"config":{"lang":["en"],"separator":"[\\s\\u200b\\-]","pipeline":["stemmer"]},"docs":[{"location":"","title":"Tips","text":"<p>\u5f00\u53d1\u6d41\u7a0b\u9700\u8981\u6ce8\u610f\u7684\u70b9\u3002</p>"},{"location":"#todo","title":"TODO","text":"<ul> <li>API Document - swagger</li> <li>Docker Compose(Development Environment)</li> </ul>"},{"location":"code_quality/","title":"Code Quality Management of Project Workflow","text":"<p>Define</p> <p>Code Quality: code style, code logic, code recommended (replace or upgrade).</p> <p> PEP8 \u662f\u5b98\u65b9\u51fa\u54c1\u7684 code style\uff0c\u4e0d\u5c11\u516c\u53f8\u4e5f\u6709\u81ea\u5df1\u7684\u4e00\u5957 style\uff0c\u9664\u4e86\u5e73\u65f6 coding \u65f6\u6ce8\u610f\u9075\u5faa\u5916\uff0c\u597d\u7684\u683c\u5f0f\u5316\u5de5\u5177\u548c\u68c0\u67e5\u5de5\u5177\u4e5f\u662f\u4fdd\u8bc1\u4ee3\u7801\u8d28\u91cf\u7684\u5fc5\u8981\u73af\u8282\u3002\u8fd8\u597d\u73b0\u5728 Python \u751f\u6001\u5f88\u597d\uff0c\u6709\u4e0d\u5c11\u5de5\u5177\u90fd\u53ef\u4ee5\u5b9e\u73b0\u3002</p>"},{"location":"code_quality/#code-quality-tools","title":"Code Quality Tools","text":"<p>\u53c2\u6570\u914d\u7f6e\uff08\u73af\u5883\u53d8\u91cf\uff09\u4e00\u822c\u90fd\u662f\u9996\u5148\u8981\u89e3\u51b3\u7684\uff0c\u968f\u7740\u53d1\u5c55 Python \u5728\u8fd9\u4e9b\u65b9\u9762\u4e5f\u8d8a\u6765\u8d8a\u89c4\u8303\u548c\u7edf\u4e00\uff0c\u8fd9\u4e5f\u7ed9\u5f00\u53d1\u5e26\u6765\u4e86\u4e0d\u5c11\u4fbf\u6377\uff0c\u5176\u4e2d\u6700\u91cd\u8981\u7684\u662f PEP 621\uff0c\u4e3a\u7edf\u4e00\u914d\u7f6e\u9879\u6253\u4e0b\u57fa\u7840\u3002\u9664\u6b64\u4e4b\u5916\u8fd8\u6709\u5229\u7528\u5176\u5b83\u5df2\u6709\u914d\u7f6e\u9009\u9879\u4e3a\u914d\u7f6e\u8fdb\u4e00\u6b65\u7f29\u51cf\u4e86\u590d\u6742\u5ea6\uff08\u4e00\u5904\u914d\u7f6e\u5373\u53ef\uff09\u2014\u2014 <code>.gitignore</code>\uff0c\u4e00\u4f1a\u513f\u5c31\u80fd\u770b\u5230\u5f88\u591a\u5de5\u5177\u90fd\u590d\u7528\u4e86\u6b64\u6587\u4ef6\u5927\u5927\u51cf\u5c11\u4e86\u914d\u7f6e\u6d41\u7a0b\u3002</p> <p>\u6b64\u9879\u76ee\u7528\u5230\u7684\u5de5\u5177\u5305\u62ec\uff1a</p> <ul> <li>Project and virtualenv management with dependencies (pyproject.toml): PDM</li> <li>Formatter (code style): black</li> <li>Linter (code style and static code logic and code recommend): ruff</li> <li>Static type checker (static code logic): mypy</li> <li>Test (dynamic code logic): pytest</li> </ul> <p>\u6ce8\u610f</p> <p>Python &gt;= 3.11.1</p> \u5b89\u88c5\u4f9d\u8d56<pre><code>pdm add -d black ruff\n</code></pre>"},{"location":"code_quality/#formatter-black","title":"Formatter - black","text":"<p>\u683c\u5f0f\u5316\u5de5\u5177\u8f83\u5e38\u7528\u7684\u6709\u4e24\u4e2a\uff1ablack \u662f\u4e00\u4e2a pep8 \u98ce\u683c\u7684\u683c\u5f0f\u5316\u5de5\u5177\uff0cisort \u662f\u4e00\u4e2a \u53ef\u4ee5\u6392\u5e8f import \u7684\u5de5\u5177\u3002\u5176\u4e2d isort \u5df2\u7ecf\u88ab linter \u5de5\u5177 ruff (--fix) \u6240\u66ff\u4ee3\uff0c\u800c black \u7684\u683c\u5f0f\u5316\u529f\u80fd\u8fd8\u5728\u5b8c\u5584\u4e2d\uff0c\u671f\u5f85\u4e4b\u540e\u7684\u5927\u7edf\u4e00\uff0cAll in one~</p> <p>\u5176\u5b83\u7684\u5de5\u5177\u8fd8\u6709</p> <ul> <li>autopep8</li> <li>yapf</li> </ul> <p>\u5e38\u7528\u914d\u7f6e\u9009\u9879\u5982\u4e0b\uff1a</p> pyproject.toml<pre><code>[tool.black]\nline-length = 120\n# 23.1.0 \u4e4b\u540e\u5c06\u81ea\u52a8\u63a8\u65ad python \u7248\u672c\n# target-version = [\"py311\"]\n# extend-exclude = '| migragte'\n</code></pre> <p>black \u4f1a\u81ea\u52a8\u52a0\u8f7d\u6839\u76ee\u5f55\u4e0b\u7684 pyproject.toml \u4e2d\u76f8\u5173\u914d\u7f6e\u3002\u5f53\u4e0d\u8bbe\u7f6e exclude \u9009\u9879\u65f6\uff0cblack \u81ea\u52a8\u6392\u9664 <code>gitignore</code> \u4e2d\u914d\u7f6e\u9879\u3002</p> <p>Tip</p> TOML<pre><code>exclude = '''\n/(\n    | \\.direnv\n    | \\.eggs\n    | \\.git\n    | \\.hg\n    | \\.mypy_cache\n    | \\.nox\n    | \\.tox\n    | \\.venv\n    | venv\n    | \\.svn\n    | \\.ipynb_checkpoints\n    | _build\n    | buck-out\n    | build\n    | dist\n    | __pypackages__\n)/\n'''\n# | \u5f00\u5934\u8868\u793a\u4efb\u610f\u4f4d\u7f6e\uff0c ^/ \u5f00\u5934\u8868\u793a\u6839\u76ee\u5f55\u4e0b\u3002\n</code></pre> <p>\u914d\u7f6e\u597d\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528 <code>pdm run black .</code> \u68c0\u67e5\u3002<code>--check</code> \u53ef\u4ee5</p> Bash<pre><code># check and format\npdm run black .\n# or only check\npdm run black --check .\n</code></pre>"},{"location":"code_quality/#linter-ruff","title":"Linter - ruff","text":"<p>\u5229\u7528\u9759\u6001\u6e90\u7801\u5206\u6790(static source code analysis)\u68c0\u67e5\u4ee3\u7801\u98ce\u683c\u3001\u903b\u8f91\u548c\u53ef\u80fd\u7684\u4f18\u5316\u65b9\u6848\uff0c\u6765\u8fbe\u5230 clean code\u3002flake8 \u662f\u5176\u4e2d\u4e00\u4e2a\u8f83\u4e3a\u51fa\u540d\u7684 linter\uff08\u5b9e\u8d28\u662fPyFlakes\u3001pycodestyle\u3001McCabe \u7684wrapper \uff09\uff0c\u5e76\u6709\u8bb8\u591a\u56f4\u7ed5\u5176\u7684 plugins\u3002\u800c\u76ee\u524d ruff \u4f5c\u4e3a\u540e\u8d77\u4e4b\u79c0\u5927\u6709\u671b\u5176\u9879\u80cc\u7684\u8d8b\u52bf\uff0c\u4e14\u66f4\u73b0\u4ee3\u5316\u3001\u66f4\u4fbf\u6377\u3001\u66f4\u7edf\u4e00\uff0c\u4f46\u5176\u8fd8\u4e0d\u592a\u7a33\u5b9a\uff0c\u66f4\u65b0\u9891\u7e41\u4e14\u6709\u80af\u80fd breaking change\u3002\u672c\u6587\u91c7\u7528 ruff\uff0c\u4e24\u8005\u7684 linter \u4ee3\u53f7\u57fa\u672c\u4e00\u81f4\uff0c\u5207\u6362\u5e94\u8be5\u4e0d\u96be\u3002</p> <p>\u5e38\u7528\u7684 linter \u53ca\u4ee3\u53f7\uff1a</p> \u4ee3\u53f7 \u539f\u6709\u5e93 \u529f\u80fd F pyflakes code logic E pycodestyle pep8 \u57fa\u7840\u89c4\u8303, \u4e0d\u5305\u62ec naming docstring W pycodestyle pep8 \u57fa\u7840\u89c4\u8303 D pydocstyle <code>docstring conventions</code> \u8865\u5145 pycodestyle N pep8-naming <code>naming conventions</code> \u8865\u5145 pycodestyle A flake8-builtins \u662f\u5426\u8986\u76d6\u4e86\u5185\u7f6e\u53d8\u91cf\u540dpep8-naming B flake8-bugbear (opinionated) \u8865\u5145 pyflakes \u548c pycodestyle \uff08\u8f83\u6742\u4e71\uff09 PIE flake8-pie \u6ca1\u6709\u5fc5\u8981\u7684 pass \u6216\u591a\u4f59 <code>**</code> \u8865\u5145 pyflakes \u548c pycodestyle \u7684\u6742\u9879 C4 flake8-comprehensions recommend <code>comprehension</code> replace DTZ flake8-datetimez datetime recommend <code>tzinfo</code> replace PTH flake8-use-pathlib recommend <code>pathlib</code> replace SIM flake8-simplify \u7b80\u5316\u8bed\u53e5\u6216\u8c03\u7528 recommend code replace UP pyupgrade upgrade syntax for newer versions ANN flake8-annotations \u51fd\u6570\u662f\u5426\u4f7f\u7528 annotations\uff0c\u4e0e mypy \u76f8\u8f85\u76f8\u6210 TCH flake8-type-checking imports to move in or out of type-checking blocks C90 mccabe <code>function complex</code> \u590d\u6742\u5ea6\u68c0\u67e5 Q flake8-quotes \u5f15\u53f7\u76f8\u5173 S flake8-bandit security \u6bd4\u5982\u786c\u7f16\u7801\u5bc6\u7801 I isort import sorted BLE flake8-blind-except \u68c0\u67e5 except PT flake8-pytest-style pytest \u76f8\u5173 G flake8-logging-format recomad logging use extra Ruff 0.0.238+ Bash<pre><code># \u67e5\u770b\u6240\u6709\u652f\u6301\u7684 Linter\nruff linter\n# \u67e5\u770b\u67d0\u4e2a\u89c4\u5219\u7684\u8bf4\u660e\nruff rule D401\n</code></pre> <p>\u8fd8\u4e0d\u652f\u6301\u7684 linter</p> <ul> <li>match case (Structural Pattern Matching)</li> </ul> <p>\u5e38\u7528\u7684\u914d\u7f6e\u5982\u4e0b\uff1a</p> pyproject.toml<pre><code>[tool.ruff]\nline-length = 120\ntarget-version = \"py311\"\nselect = [\n\"F\",   # pyflake\n\"E\",   # pycodestyle\n\"W\",   # pycodestyle\n\"B\",   # bugbear\n\"N\",   # naming\n\"I\",   # isort\n\"UP\",  # upgrade\n\"A\",   # builtins\n\"S\",   # bandit\n\"SIM\",\n\"RUF\",\n\"PTH\",\n\"ANN\",\n]\nignore = ['D211', 'D213']\n# include .gitignore\nrespect-gitignore = true\n[tool.ruff.pydocstyle]\n# Google-style docstrings\nconvention = \"google\"\n[tool.ruff.flake8-builtins]\nbuiltins-ignorelist = [\"id\"]\n</code></pre> <p>\u6301\u7eed\u5173\u6ce8</p> <p>ruff \u9700\u8981\u4e0e black \u4e00\u540c\u4f7f\u7528\uff0c\u56e0\u4e3a ruff \u6682\u7f13\u4e86\u76f8\u5173 formatter \u5de5\u4f5c\u3002</p> <p>\u68c0\u67e5\uff1a</p> RUN<pre><code>ruff .\n# or\nruff check .\n</code></pre>"},{"location":"code_quality/#static-type-checking-with-mypy","title":"Static type checking with mypy","text":"<p>Python \u662f\u5f3a\u7c7b\u578b\u52a8\u6001\u8bed\u8a00\uff0c\u9700\u8981\u8fd0\u884c\u65f6\u8fdb\u884c\u7c7b\u578b\u63a8\u5bfc\uff0c\u8fd9\u662f\u4ed6\u7684\u4f18\u52bf\u4f46\u4e5f\u662f\u52a3\u52bf\u3002\u4e3a\u4e86\u66f4\u597d\u7684\u5728\u9759\u6001\u6e90\u7801\u5206\u6790\u65f6\u53d1\u73b0\u95ee\u9898\uff0c\u5f15\u5165\u4e86 type hint\uff0c\u901a\u8fc7\u7c7b\u578b\u68c0\u67e5\u6765\u589e\u5f3a\u7f16\u7801\u8d28\u91cf\u548c\u7f16\u8f91\u63d0\u793a\u3002</p> <p>type annotation (PEP 3107)\u53ea\u5b9a\u4e49\u4e86\u51fd\u6570\u6ce8\u89e3\uff0ctype hint (PEP 484)\u8303\u56f4\u66f4\u5927\u3002</p> <p>Tip</p> <p>mypy \u662f\u4e00\u4e2a\u5728\u7f16\u8bd1\u65f6\u8fdb\u884c\u7c7b\u578b\u68c0\u67e5\u7684\u5de5\u5177\u3002 pydantic \u662f\u4e00\u4e2a runtime type checking\u3002</p> <p>\u5e38\u7528\u914d\u7f6e\u9009\u9879\u5982\u4e0b\uff1a</p> pyproject.toml<pre><code>[tool.mypy]\n# \u5982\u679c\u4e0d\u6307\u5b9a\u5219\u6309\u7167 mypy \u6240\u4f9d\u8d56\u7684\u73af\u5883\npython-version = 3.11\n</code></pre> <p>Tip</p> <p>mypy \u4e5f\u53ef\u4ee5\u4ece\u9879\u76ee\u6839\u76ee\u5f55\uff08\u5f53\u524d\u8fd0\u884c\u76ee\u5f55\uff09\u7684 pyproject.yoml \u8bfb\u53d6\u914d\u7f6e</p>"},{"location":"code_quality/#when-should-they-be-used","title":"When should they be used?","text":""},{"location":"code_quality/#coding","title":"coding","text":"<p>\u4f7f\u7528 vscode editor \u65f6\u53ef\u4ee5\u5b89\u88c5\u63d2\u4ef6\u652f\u6301 format \u548c lint\u3002 \u6216\u8005\u4f7f\u7528\u547d\u4ee4\u884c\u5f62\u5f0f\u3002</p> <ul> <li>Black Formatter \u8bbe\u7f6e python \u7684\u9ed8\u8ba4\u683c\u5f0f\u5316\u5de5\u5177\u5373\u53ef\u3002</li> <li>Ruff \u63d0\u793a\u548c\u81ea\u52a8\u4fee\u590d</li> <li>mypy \u5f53\u524d\u73af\u5883\u5b89\u88c5 mypy \u540e\u8bbe\u7f6e\u5982\u4e0b\uff0c\u6216\u8005\u4f7f\u7528 Mypy \u63d2\u4ef6\u3002\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 vscode \u81ea\u5e26\u7684 pyright\uff08\u4e0e mypy \u4e00\u6837\u662f\u9759\u6001\u7c7b\u578b\u68c0\u67e5\u5668\uff09   JSON<pre><code>  {\n\"python.linting.mypyEnabled\": true\n}\n</code></pre></li> </ul>"},{"location":"code_quality/#committing","title":"committing","text":"<p>\u4f7f\u7528 pre-commit hooks\uff0c\u914d\u7f6e <code>.pre-commit-config.yaml</code> \u540e\u8fd0\u884c <code>pre-commit install</code> \u5b89\u88c5 git hook \u811a\u672c\u3002</p> <p>Warning</p> <p>\u672c\u5730\u9879\u76ee\u9700\u8981\u7eb3\u5165 git \u7ba1\u7406\uff0c\u5373\u9879\u76ee\u76ee\u5f55\u4e0b\u6709 <code>.git</code> \u6587\u4ef6\u5939\u3002</p> <p>\u4e4b\u540e\u518d <code>git commit</code> \u90fd\u4f1a\u5148\u8fd0\u884c\u68c0\u67e5\uff0c\u5982\u679c\u4e0d\u901a\u8fc7\u5219\u4e0d\u80fd\u63d0\u4ea4\u3002</p> .pre-commit-config.yaml<pre><code>repos:\n- repo: https://github.com/psf/black\nrev: 23.1.0\nhooks:\n- id: black\nlanguage_version: python3.11\n- repo: https://github.com/charliermarsh/ruff-pre-commit\nrev: v0.0.239\nhooks:\n- id: ruff\n</code></pre>"},{"location":"code_quality/#checked-in-ci-pipeline","title":"checked in (CI pipeline)","text":"<p>\u786e\u4fdd\u9879\u76ee\u5e93\u4e2d\u7684\u4ee3\u7801\u8d28\u91cf\u3002</p> .github/workflows/ci.yaml<pre><code>name: CI\non: [push]\njobs:\ntest:\nname: \"Testing\"\nstrategy:\nfail-fast: false\nmatrix:\npython-version: [\"3.11\"]\npdm-version: [\"2.4.2\"]\nos: [ubuntu-latest]\nruns-on: ${{ matrix.os }}\nsteps:\n- uses: actions/checkout@v3\n- name: Set up PDM (with Python)\nuses: pdm-project.setup-pdm@v3\nwith:\npython-version: ${{ matrix.python-version }}\nversion: ${{ matrix.pdm-version }}\n- name: Install dependencies\nrun: |\npdm sync -d -G test\n- name: Run Test\nrun: |\npdm run pytest --cov=./ --cov-report=xml tests\n# - name: Upload coverage to Codecov\n#   uses: codecov/codecov-action@v3\ncode-quality:\nname: \"Code Quality\"\nstrategy:\nfail-fast: false\nmatrix:\npython-version: [\"3.11\"]\npdm-version: [\"2.4.2\"]\nos: [ubuntu-latest]\nruns-on: ${{ matrix.os }}\nsteps:\n- uses: actions/checkout@v3\n- name: Set up PDM (with Python)\nuses: pdm-project.setup-pdm@v3\nwith:\npython-version: ${{ matrix.python-version }}\nversion: ${{ matrix.pdm-version }}\n- name: Install dependencies\nrun: |\npdm sync -d\n- name: Run Black\nrun: |\npdm run -v black . --check --exclude=tests/\n- name: Run Ruff\nrun: |\npdm run -v ruff --format=github .\n- name: Run Mypy\nrun: |\npdm run -v mypy . --prety\n- name: Run Safety\nrun: pdm run -v safety check\n</code></pre>"},{"location":"code_quality/#conclusion","title":"Conclusion","text":"<ul> <li>\u7f16\u5199\u4ee3\u7801\u65f6\uff0c\u4f7f\u7528 black \u6e29\u548c\u7684\u683c\u5f0f\u5316\u4e3a\u7b26\u5408 pep8 \u98ce\u683c\u7684\u4ee3\u7801\uff0c\u7136\u540e\u5229\u7528 ruff \u8fdb\u4e00\u6b65\u68c0\u67e5\u4ee3\u7801\u98ce\u683c\u548c\u903b\u8f91\uff0c\u6700\u540e\u518d\u4f7f\u7528 mypy \u68c0\u67e5\u4ee3\u7801\u7c7b\u578b\u662f\u5426\u6b63\u786e\uff0c\u53ef\u9009\u7684\u662f\u4f7f\u7528 pytest \u8fdb\u884c\u6d4b\u8bd5\uff0c\u53ef\u4ee5\u8fdb\u4e00\u6b65\u589e\u5f3a\u4ee3\u7801\u8d28\u91cf\u3002</li> <li>\u5411\u4ed3\u5e93\u63d0\u4ea4\u4ee3\u7801\u524d\uff0c\u5229\u7528 pre-commit \u518d\u6b21\u68c0\u67e5\uff0c\u786e\u4fdd\u63d0\u4ea4\u7684\u4ee3\u7801\u7b26\u5408\u89c4\u8303\u3002</li> <li>\u4ed3\u5e93\u81ea\u6211\u68c0\u67e5\uff0c\u5229\u7528 github action \u68c0\u67e5\u4ed3\u5e93\u4e2d\u7684\u4ee3\u7801\u662f\u5426\u7b26\u5408\u89c4\u8303\u786e\u4fdd\u5176\u5b83\u4eba\u4e5f\u6b63\u786e\u63d0\u4ea4\u4e86\u4ee3\u7801\u3002</li> </ul>"},{"location":"code_quality/#next-steps","title":"Next Steps","text":"<ul> <li>mypy \u53ef\u4ee5\u68c0\u67e5\u7684\u7c7b\u578b\u5f88\u591a\uff0c\u53ef\u4ee5\u67e5\u770b\u6587\u6863\u5b66\u4e60\u66f4\u591a\u7684 type hint \u6280\u5de7</li> <li>pytest \u4e5f\u662f\u4e00\u9879\u91cd\u8981\u4e14\u590d\u6742\u7684\u5de5\u4f5c\uff0c\u9700\u8981\u66f4\u6df1\u5165\u7684\u5b66\u4e60</li> <li>\u53ef\u4ee5\u5229\u7528 github action \u505a\u66f4\u591a\u6709\u8da3\u7684\u4e8b\u513f\uff0c\u6bd4\u5982\u81ea\u52a8\u751f\u6210\u6587\u6863</li> </ul>"},{"location":"code_quality/#reference","title":"Reference","text":"<p>\u4f7f\u7528 pyproject.toml \u4fdd\u8bc1\u4ee3\u7801\u8d28\u91cf</p> <p>An open source Python project CI pipeline</p> <p>Python Code Quality</p>"},{"location":"docker/","title":"Docker Service","text":"<p>Docker \u662f\u4e00\u79cd\u4e3a\u7a0b\u5e8f\u63d0\u4f9b\u9694\u79bb\u73af\u5883\u7684\u5bb9\u5668\u5316\u6280\u672f\uff0c\u4ee5\u5230\u8fbe\u201c\u4e00\u6b21\u5c01\u88c5\uff0c\u5230\u5904\u8fd0\u884c\u201d\u3002</p> <ul> <li>\u6587\u4ef6\u3001\u8d44\u6e90\u3001\u7f51\u7edc\u9694\u79bb\u3002</li> <li>\u53d8\u66f4\u7ba1\u7406\u3001\u65e5\u5fd7\u8bb0\u5f55</li> <li>\u5199\u65f6\u590d\u5236</li> </ul> <p>Docker \u53ef\u4ee5</p> <ul> <li>\u6709\u6548\u5229\u7528\u7cfb\u7edf\u8d44\u6e90\uff0c\u4e0d\u9700\u8981\u865a\u62df\u786c\u4ef6\u53ca\u5b8c\u6574\u7684\u64cd\u4f5c\u7cfb\u7edf\u3002</li> <li>\u66f4\u5feb\u7684\u542f\u52a8\u65f6\u95f4\u3002\u76f4\u63a5\u8fd0\u884c\u5728\u5bbf\u4e3b\u5185\u6838\uff0c\u65e0\u9700\u542f\u52a8\u5b8c\u6574\u7684\u64cd\u4f5c\u7cfb\u7edf\u3002</li> <li>\u4e00\u81f4\u7684\u8fd0\u884c\u73af\u5883\u3002\u4e0d\u4ec5\u63d0\u4f9b\u4e00\u81f4\u7684\u5185\u6838\uff0c\u8fd8\u6709\u4e00\u81f4\u7684\u8fd0\u884c\u65f6\u73af\u5883\u3002\u66f4\u65b9\u4fbf\u79fb\u690d\u548c\u90e8\u7f72\u3002</li> <li>\u8f7b\u677e\u7684\u7ef4\u62a4\u548c\u6269\u5c55\u3002\u4f7f\u7528\u5206\u5c42\u5b58\u50a8\u548c\u955c\u50cf\u6280\u672f\uff0c\u91cd\u590d\u90e8\u5206\u53ef\u590d\u7528\uff0c\u57fa\u4e8e\u955c\u50cf\u6613\u4e8e\u6269\u5c55\u3002</li> </ul> <p>\u4e0e\u4f20\u7edf\u865a\u62df\u673a\u7684\u5bf9\u6bd4</p> \u7279\u6027 Docker \u865a\u62df\u673a \u542f\u52a8 \u79d2\u7ea7 \u5206\u949f\u7ea7 \u786c\u76d8\u4f7f\u7528 MB GB \u6027\u80fd \u63a5\u8fd1\u539f\u751f \u5f31 \u7cfb\u7edf\u652f\u6301\u91cf \u5355\u673a\u4e0a\u5343\u4e2a \u5341\u51e0\u4e2a"},{"location":"docker/#docker","title":"Docker\u6838\u5fc3\u6982\u5ff5","text":"<p>\u4e09\u5927\u7ec4\u4ef6\uff1a</p> <ul> <li> <p>\u955c\u50cf\uff08Image\uff09\uff1a\u4e00\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u7684\u6700\u5c0f\u6838\u5fc3\u6587\u4ef6\uff08\u5982ubuntu root\u6587\u4ef6\u7cfb\u7edf\uff09\uff0c\u53ef\u5206\u5c42\u6587\u4ef6\u7cfb\u7edf\u3002</p> </li> <li> <p>\u5bb9\u5668\uff08Container\uff09\uff1a\u4e00\u79cd\u5728\u8fd0\u884c\u4e2d\uff08\u9694\u79bb\u4e8e\u5bbf\u4e3b\u673a\u7684\u8fdb\u7a0b\uff09\u7684\u955c\u50cf\u3002</p> </li> <li> <p>\u4ed3\u5e93\uff08Repository\uff09\uff1a\u76db\u653e\u955c\u50cf\u7684\u5730\u65b9\uff0c\u65b9\u4fbf\u4e0d\u540c\u670d\u52a1\u5668\u90e8\u7f72\u3002</p> </li> </ul> <p></p>"},{"location":"docker/#docker-docker-compose","title":"\u5b89\u88c5 Docker \u548c Docker Compose","text":"<p>Install Docker Engine on Ubuntu </p>"},{"location":"docker/#docker-image-builddockerfile","title":"Docker Image Build\uff08Dockerfile\uff09","text":"<p>Docker Best Practices for Python Developers | TestDriven.io</p> <ul> <li>Use Multi-stage Builds</li> <li>Use Small Docker Image (slim)</li> <li>Minimize the Number of Layers</li> <li>Cache Python Packages to the Docker Host</li> <li>ENTRYPOINT and CMD Use exec Syntax</li> </ul> <p>Web development example:</p> Docker<pre><code># syntax=docker/dockerfile:1\n#### builder stage\nFROM python:3.11.2-slim-bullseye AS builder\nRUN --mount=type=cache,target=/var/cache/apt \\\napt-get update &amp;&amp; apt-get install -y procps \\\n&amp;&amp; rm -rf /var/lib/apt/list/*\n\n# install pdm\nRUN --mount=type=cache,target=/root/.cache/pip \\\npip install pdm==2.4.5\n\n# install dependencies\nCOPY pyproject.toml pdm.lock /\nRUN mkdir __pypackages__ RUN --mount=type=cache,target=/root/.cache/pdm \\\npdm install --dev --no-lock --no-editable\n\n#### final stage\nFROM python:3.11.2-slim-bullseye\n# dependencies\nENV PYTHONPATH=/pkgs/lib\nENV PATH=\"/pkgs/bin:$PATH\"\nENV TZ=Asia/Shanghai\n\nCOPY --from=builder /__pypackages__/3.11 /pkgs\n\nCOPY ./entrypoint /entrypoint\nRUN chmod +x /entrypoint\n\nWORKDIR /app\nENTRYPOINT [\"/entrypoint\"]\n</code></pre> <p>\u7b2c\u4e00\u884c\u7684\u6ce8\u91ca\u662f\u4f7f\u7528\u65b0\u8bed\u6cd5\u7684\u6807\u51c6\uff0c\u542f\u7528\u65b0\u8bed\u6cd5\u540e\u53ef\u4ee5\u5c06 RUN \u7f13\u5b58\u5230 Docker \u4e2d\u3002</p> Bash<pre><code># \u6784\u5efa image\ndocker image build -t &lt;tag_name&gt; .\n# . \u8868\u793a\u628a\u5f53\u524d\u6587\u4ef6\u5939\u6240\u6709\u6587\u4ef6\u4f5c\u4e3a\u6784\u5efa\u73af\u5883\uff08build context\uff09\uff0c\u6784\u5efa\u73af\u5883\u4f1a\u53d1\u9001\u7ed9docker\u8fdb\u884c\u4e4b\u540e\u7684\u6784\u5efa\u64cd\u4f5c\u3002\u53ef\u4ee5\u4f7f\u7528 .dockerignore \u6392\u9664\u4e0d\u9700\u8981\u53c2\u52a0\u6784\u5efa\u7684\u6587\u4ef6\u3002\n# \u67e5\u770b\u672c\u6bb5\u955c\u50cf\ndocker images -a -q\n# -a all \u6240\u6709\u955c\u50cf\uff0c\u5305\u542b\u5386\u53f2\u6620\u50cf\u5c42\n# -q quit \u53ea\u663e\u793a\u955c\u50cfid\n# \u67e5\u770b\u6784\u5efa\u8fc7\u7a0b\ndocker history &lt;commit&gt;\n</code></pre> <p>\u751f\u4ea7\u4e2d Dockerfile \u8fd8\u5e94\u8be5\uff1a</p> <ul> <li>\u4f7f\u7528\u975e root \u7528\u6237</li> <li>COPY file</li> <li>\u975e\u5bc6\u7801</li> <li>\u8bbe\u7f6e\u5185\u5b58\u548cCPU\u9650\u5236</li> </ul> Docker<pre><code># \u521b\u5efa\u7528\u6237\u548c\u5206\u7ec4, -r \u521b\u5efa\u7cfb\u7edf\u7ec4\uff0c\u4e0e\u666e\u901a\u7ec4\u6ca1\u6709\u672c\u8d28\u533a\u522b\uff0cuseradd \u4e0d\u4f1a\u521b\u5efa\u5bf9\u5e94\u7684\u4e3b\u76ee\u5f55\n# -g \u8bbe\u7f6e\u4e3b\u5206\u7ec4\uff0c -G \u6dfb\u52a0\u989d\u5916\u5206\u7ec4\uff0c -u \u6dfb\u52a0uid\nRUN groupadd -r appgroup &amp;&amp; \\  # \u521b\u5efa\u7cfb\u7edf\u5206\u7ec4\n    useradd -r -u 5678 -g appgroup appuser  &amp;&amp; \\  # \u521b\u5efa\u7528\u6237\u5e76\u52a0\u5165\u5206\u7ec4\n    chown -R appgroup:appuser /app  # \u8bbe\u7f6e\u6587\u4ef6\u6743\u9650\n# \u5207\u6362\u7528\u6237\uff0c \u4e4b\u540e\u90fd\u662fappuser \u7528\u6237\u5728\u64cd\u4f5c\nUSER appuser\n# \u5bb9\u5668\u542f\u52a8\u547d\u4ee4\n# ENTRYPOINT \u4e0d\u4f1a\u8986\u76d6\uff0c\u53ef\u4ee5\u591a\u4e2a\nENTRYPOINT ['\u547d\u4ee4', '\u53c2\u6570']\n# CMD \u5728 docker container run \u65f6\u53ef\u4ee5\u8986\u76d6\uff0c\u591a\u6761 CMD \u53ea\u4f1a\u6267\u884c\u6700\u540e\u4e00\u4e2a\n# CMD ['&lt;\u547d\u4ee4&gt;', '&lt;\u53c2\u6570&gt;']\nCMD [\"gunicorn\", \"--worker-tmp-dir\", \"/dev/shm\", \"--bind\", \"0.0.0.0:8000\", \"wsgi:app\"]\n# \u6709\u65f6\u4f1a\u8054\u5408\u4f7f\u7528 ENTRYPOINT \u6307\u5b9a \u547d\u4ee4\uff0c CMD \u6307\u5b9a\u53c2\u6570\uff0c\u8fd9\u6837run\u65f6\u53ef\u4ee5\u4fee\u6539\u53c2\u6570\u3002\n</code></pre> <p>\u6ce8\u610f\uff1a</p> <ul> <li>FROM \u57fa\u7840\u955c\u50cf\u5c3d\u91cf\u9009\u62e9\u5c0f\u7684\uff0calpine \u662f\u6700\u5c0f\u7684Linux\u955c\u50cf\uff0c\u8bb8\u591a Image \u90fd\u6709\u57fa\u4e8e\u5b83\u7684\u57fa\u7840\u955c\u50cf\u3002slim\u5728alpine\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u5e38\u7528\u8f6f\u4ef6\uff0c\u4f53\u79ef\u4e5f\u8f83\u5c0f\u3002</li> <li>RUN \u547d\u4ee4\u5c3d\u91cf\u5360\u4e00\u884c\uff0c\u5e76\u5220\u9664\u4e0d\u5fc5\u8981\u7684\u6587\u4ef6\uff08\u8282\u7701\u7a7a\u95f4\uff09</li> <li>COPY \u7528\u4e8e\u62f7\u8d1d\u666e\u901a\u6587\u4ef6\uff0cADD\u7528\u4e8e\u62f7\u8d1d\u538b\u7f29\u6587\u4ef6\u3002</li> <li>\u53ea\u6784\u5efa\u5c3d\u91cf\u4f7f\u7528 ARG\uff0c\u5982\u679c\u540e\u9762\u8fd8\u9700\u8981\u4f7f\u7528\u5219 ENV</li> <li>\u591a\u9636\u6bb5\u6784\u5efa\u591a\u7528\u4e8e\u5148\u7f16\u8bd1\u7684\uff0c\u7136\u540e\u6267\u884c\u5206\u5f00\u7684\u6784\u6210\u3002</li> <li>Gunicorn 20.1.0 \u4f7f\u7528\u57fa\u4e8e\u6587\u4ef6\u7684\u4fe1\u53f7\u68c0\u6d4b\u7cfb\u7edf\u6765\u786e\u4fdd worker \u8fdb\u7a0b\u5b58\u6d3b\uff0cheartbeat files \u4e00\u822c\u5b58\u5728 <code>/tmp</code> \uff0c\u7531\u4e8e docker \u4e0d\u652f\u6301 tmpfs \u6587\u4ef6\u7cfb\u7edf\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4worker\u963b\u585e\uff0c\u53ef\u4ee5\u901a\u8fc7 --worker-tmp-dir \u4fee\u6539 heartbeat directory \u4e3a/dev/shm\u89e3\u51b3\u3002/dev/shm \u662fUbuntu\u4e2d\u6307\u5b9a\u7684 tmpfs \u6587\u4ef6\u7cfb\u7edf\u3002</li> </ul>"},{"location":"docker/#_1","title":"\u65b0\u8bed\u6cd5","text":"<p>\u542f\u7528\u65b0\u8bed\u6cd5\uff0c\u6bd4\u5982\u7f13\u5b58 RUN</p> <p>\u7b2c\u4e00\u884c\u6dfb\u52a0\uff1a<code># syntax=docker/dockerfile:1</code></p> Text Only<pre><code># syntax=docker/dockerfile:1\nFROM ubuntu:22.04\n\n# install app dependencies\nRUN apt-get update &amp;&amp; apt-get install -y python3 python3-pip\nRUN pip install flask==2.1.*\n\n# install app\nCOPY hello.py /\n\n# final configuration\nENV FLASK_APP=hello\nEXPOSE 8000\nCMD flask run --host 0.0.0.0 --port 8000\n</code></pre>"},{"location":"docker/#docker-container-run","title":"Docker Container Run","text":"<p>\u547d\u4ee4\u884c\u8fd0\u884c</p> Bash<pre><code># \u8fd0\u884c \u5bb9\u5668\uff08\u5f53\u524dDockerfile\u76ee\u5f55\uff09\ndocker contaienr run --rm -it &lt;\u5bb9\u5668\u540d&gt;\n# --rm \u9000\u51fa\u65f6\u81ea\u52a8\u5220\u9664\u5bb9\u5668\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u6bcf\u6b21\u8fd0\u884c\u9000\u51fa\u540e\u90fd\u4ea7\u751f\u4e00\u4e2a\u9000\u51fa\u72b6\u6001\u7684\u5bb9\u5668\u4e86\uff0c\u8981\u4e0d\u8fd8\u5f97prune\u5220\u9664\n# -it \u4ea4\u4e92\u5f0f\u8fd0\u884c\u54ea\u4e2a\u5bb9\u5668\n# \u8fdb\u5165\u5bb9\u5668\u7684\u547d\u4ee4\u884c\u4ea4\u4e92\u73af\u5883\u4e0b\ndocker container exec -it &lt;\u5bb9\u5668\u540d&gt; /bin/sh\n</code></pre>"},{"location":"docker/#docker-volume","title":"Docker volume \u5b58\u50a8","text":"<p>\u5206\u4e24\u79cd\uff1aData Volume \u548c Bind Volume\u3002Data Volume \u662f Docker \u7ba1\u7406\uff0c\u53ef\u4ee5\u901a\u8fc7 docker volume \u6765\u7ba1\u7406\uff0c\u9ed8\u8ba4\u5b58\u50a8\u5728<code>/var/lib/docker/volumes</code>\uff0cBind Volume \u662f\u7528\u6237\u628a\u6587\u4ef6\u7cfb\u7edf\u7684\u67d0\u4e00\u4f4d\u7f6e\uff08\u901a\u5e38\u662f\u5f53\u524d\u76ee\u5f55\u4e0b\u7684data\u6587\u4ef6\u5939\uff09\u7ed1\u5b9a\u5230\u5bb9\u5668\u67d0\u4e00\u4f4d\u7f6e\u3002\u63a8\u8350\u4f7f\u7528 data volume \u4f1a\u51cf\u5c11\u7ba1\u7406\u56f0\u96be\uff0c\u6bd4\u5982\u591a\u4e2a\u9879\u76ee\u90fd\u4f7f\u7528\u7684\u6743\u9650\u95ee\u9898\u3002</p> Docker<pre><code># \u5728\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u5bb9\u5668\u9700\u8981\u7ed1\u5b9a\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u4f1a\u5728\u7cfb\u7edf\u6587\u4ef6\u4e2d\u521b\u5efa\u5bf9\u5e94\u7684\u5907\u4efd\uff0c\u7cfb\u7edf\u81ea\u52a8\u547d\u540d\nVOLUME ['/app/data']\n# \u8fd8\u53ef\u4ee5\nVOLUME /app/data\n# \u5728run \u65f6\u6307\u5b9a -v\uff0cmy-data \u5c31\u662f\u81ea\u5df1\u547d\u540d volume \u540d\u79f0\uff0c\u5bf9\u5e94\u540e\u9762\u7684 /app/data \ndocker container run --rm -v my-data:/app/data &lt;image_name&gt;\n\n# bind volume \u662f\u6307\u5b9a\u5177\u4f53\u8def\u5f84\ndocker container run --rm -v ./data:/app/data &lt;image_name&gt;\n</code></pre> <p>\u5e38\u7528\u7684\u547d\u4ee4</p> Bash<pre><code>docker volume ls\ndocker volume inspect &lt;volume-name&gt;\n</code></pre>"},{"location":"docker/#docker-network","title":"Docker network \u7f51\u7edc","text":"<ul> <li>\u5bb9\u5668\u95f4\u901a\u4fe1</li> <li>\u5bb9\u5668\u8bbf\u95ee\u5916\u90e8\uff0c\u6d89\u53ca\u5230ip\u8f6c\u6362\uff08NAT\uff09\uff0c\u628a\u5bb9\u5668\u7684ip\u6362\u6210docker\u7684ip\u5bf9\u5916\u8bf7\u6c42</li> <li>\u5bb9\u5668\u4e0e\u5bbf\u4e3b\u673a\u901a\u4fe1</li> <li>\u5916\u90e8\u8bbf\u95ee\u5bb9\u5668</li> </ul> <p>Docker \u9ed8\u8ba4\u7684\u7f51\u7edc\u662f bridge \uff08\u7f51\u6865\uff09\u7c7b\u578b\uff0c\u540d\u79f0\u662f docker 0\u3002</p> <p>\u9ed8\u8ba4\u7684\u5bb9\u5668\uff08\u8fde\u63a5\u8def\u7531\u5668\u7684\u7535\u8111\uff09\u521b\u5efa\u90fd\u662f\u5728\u8fd9\u91cc\u88ab\u5206\u914d\uff08\u76f8\u5f53\u4e8e\u8def\u7531\u5668\uff0c\u81ea\u5b9a\u4e49\u7684\u7f51\u7edc\u8fd8\u6709DNS\u89e3\u6790\u4f5c\u7528\uff09\uff0c\u53ef\u4ee5\u8ba9\u6240\u6709\u5bb9\u5668\uff08\u7535\u8111\uff09\u90fd\u76f8\u8fde\u3002\u4ed6\u4eec\u4e4b\u95f4\u53ef\u4ee5\u8f7b\u677e\u8bbf\u95ee\u3002</p> <p><code>-p &lt;\u5bbf\u4e3b\u673aport&gt;:&lt;\u5bb9\u5668port&gt;</code> \u4f7f\u7528\u7aef\u53e3\u8f6c\u53d1\u8ba9\u5bb9\u5668\u5177\u6709\u5916\u90e8\u8bbf\u95ee\u7684\u80fd\u529b\uff0c\u76f8\u5f53\u4e8e\u8ba9\u5bbf\u4e3b\u673a\u7684\u67d0\u4e2a\u7aef\u53e3\u76d1\u542c\u8bf7\u6c42\uff0c\u6709\u4e86\u8bf7\u6c42\u5c31\u6765\u5bb9\u5668\u7684\u67d0\u4e2a\u7aef\u53e3\u3002\u8fd9\u6837\u5916\u90e8\u5c31\u80fd\u8bbf\u95ee\u5bb9\u5668\u4e86</p> <ul> <li>\u201d\u8def\u7531\u5668\u201c\u4f5c\u7528\uff1a\u53ef\u4ee5NAT\uff08network transaction\uff09\uff0c\u8ba9\u7edf\u4e00\u7f51\u7edc\u4e4b\u95f4\u53ef\u4ee5\u76f8\u4e92\u8bbf\u95ee\uff0c\u4ee5\u53ca\u8bbf\u95ee\u5916\u90e8</li> <li>\u201dDNS\u89e3\u6790\u201c\u4f5c\u7528\uff1a\u540c\u4e00\u7f51\u7edc\u4e2d\u7684\u5bb9\u5668\u53ef\u4ee5\u901a\u8fc7\u5bb9\u5668\u540d\u5b57\uff08name\uff09\u8bbf\u95ee\u5230\u5bb9\u5668\uff0c\u5b83\u4f1a\u81ea\u52a8\u89e3\u6790\u771f\u5b9e IP\u3002</li> <li>\u9664\u4e86 bridge \u7c7b\u578b\u8fd8\u6709 host\u8868\u793a\u548c\u5bbf\u4e3b\u673a\u4f7f\u7528\u540c\u4e00\u7f51\u7edc\u3002</li> </ul> <p>\u5e38\u7528\u547d\u4ee4</p> Bash<pre><code># \u67e5\u770b\u7f51\u7edc\ndocker network ls\n\n# \u5177\u4f53\u4fe1\u606f\ndocker network inspect &lt;network-name&gt;\n\n# \u521b\u5efa\u4e00\u4e2a\u7f51\u7edc\uff08\u8def\u7531\u5668\uff09,-d\u6307\u5b9adriver\ndocker network create -d bridge &lt;network-name&gt;\n\n# \u521b\u5efa\u8fde\u63a5\u5230\u6307\u5b9a\u7f51\u7edc\u7684\u5bb9\u5668\ndocker  container run -d --rm --name container1 --network &lt;network-name&gt; &lt;iamge-name&gt;\n\n# \u5bb9\u5668\u8fde\u63a5\u5230\u67d0\u4e2a\u7f51\u7edc\ndocker network connect &lt;network-name&gt; &lt;contaienr-name&gt;\n\n# \u7f51\u7edc\u8f6c\u53d1 -p &lt;\u5bbf\u4e3b\u673aport&gt;:&lt;\u5bb9\u5668port&gt;\ndocker container run -d --rm --name container2 --network &lt;network-name&gt; -p 8080:80 &lt;image-name&gt;\n</code></pre> <p>\u8fdb\u9636\u547d\u4ee4</p> Bash<pre><code># \u5feb\u901f\u83b7\u5f97\u5bb9\u5668 ip \u5730\u5740\ndocker container inspect --format '{{.NetworkSettings.IPAddress}}' &lt;container-name&gt;\n# \u8f93\u51fa\uff1a 172.17.0.1\n</code></pre> <p>network\u4e2d\u4f7f\u7528\u5230\u4e86 iptables \uff0c\u53ef\u4ee5\u67e5\u9605\u76f8\u5173\u6587\u6863\u6df1\u5165\u5b66\u4e60\u3002</p>"},{"location":"docker/#clean","title":"Clean","text":"Bash<pre><code># \u6e05\u7406 \u4e0d\u7528\u7684 \u5bb9\u5668\u548c\u7f51\u7edc\u3001\u955c\u50cf\uff1f\ndocker system prune -f\n#\u6e05\u7406 \u4e0d\u7528\u7684 \u955c\u50cf\ndocker image prune -a\n\n# \u5220\u9664\u6240\u6709\u5bb9\u5668, -a \u8868\u793a\u5217\u51fa\u6240\u6709\uff08\u9ed8\u8ba4\u53ea\u5217\u51fa\u8fd0\u884c\u7684\uff09\uff0c -q (quiet)\u53ea\u5217\u51fa IDS\ndocker container rm -f $(docker container ps -aq)\n# \u518d\u6e05\u7406\u7528\u4e0d\u5230\uff08\u90fd\u7528\u4e0d\u5230\u4e86\uff09\u7684\u7f51\u7edc\u3001volume\u3001\u955c\u50cf\ndocker system prune -a -f\n\n# \u5220\u9664\u6240\u6709 volume !!! \u6240\u6709\u7684\u90fd\u4f1a\u5220\u9664\ndocker volume rm -f $(docker volume ls -q)\n</code></pre> <p>.dockerignore \u5f53\u4f7f\u7528<code>.</code>\u4f5c\u4e3a\u6784\u5efa\u73af\u5883\u65f6\uff0c\u53ef\u4ee5\u5ffd\u7565\u4e0d\u6240\u9700\u5185\u5bb9\uff08\u5982 venv\u6587\u4ef6\u5939\uff09\uff0c\u4ee5\u63d0\u9ad8\u6784\u5efa\u901f\u5ea6\u548c\u51cf\u5c0fimage\u5927\u5c0f\u3002\u540c\u65f6\u5bf9\u4e8e COPY \u6765\u8bf4\u4f7f\u7528 <code>.</code> \u4e5f\u4f1a\u5ffd\u7565 .dockerignore \u4e2d\u5185\u5bb9\u3002</p>"},{"location":"docker/#docker-compose","title":"Docker Compose","text":"<p>\u7f16\u6392\u591a\u4e2a\u5bb9\u5668\uff0c\u4f7f\u5f97\u7ba1\u7406\u5bb9\u5668\u66f4\u52a0\u65b9\u4fbf\u3002\u4e00\u4e2a\u9879\u76ee\u53ef\u80fd\u6709\u591a\u4e2a\u5bb9\u5668\uff08web\u3001mysql\u3001redis\u3001celery\uff09\uff0c\u628a\u6240\u6709\u5bb9\u5668\u542f\u52a8\u3001volume\u3001network\u90fd\u5b9a\u4e49\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d\uff0c\u65b9\u4fbf\u6bcf\u6b21\u64cd\u4f5c\u6216\u8005\u8fde\u63a5\u3002</p> <p>docker-compose.yml \u89e3\u91ca</p> YAML<pre><code>services:\nservice_name:  # \u670d\u52a1\u540d\u79f0\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u5bb9\u5668 id\u4f7f\u7528\uff0c\u4f1a\u9ed8\u8ba4\u589e\u52a0`_1`\ncontainer_name: web  # \u5bb9\u5668\u540d\u79f0\uff0c\u53ef\u9009\uff0c\u5168\u5c40\u552f\u4e00\nbuild: .  # \u9700\u8981\u6784\u5efa\u7684\u81ea\u5b9a\u4e49\u955c\u50cf\nenv_file: ./env  # \u73af\u5883\u53d8\u91cf\u6587\u4ef6\ncommand: []  # \u5bb9\u5668\u542f\u52a8\u540e\u8fd0\u884c\u547d\u4ee4\nports:\n- 8000:8000  # \u5bf9\u5916\u5f00\u653e\u7aef\u53e3\nnetworks:\n- frontend\nvolumes:\n- server_data:/data  # \u6301\u4e45\u5316\u5bb9\u5668\u6587\u4ef6\ndepends_on:\n- service_name_1  # \u4f9d\u8d56\u7684\u670d\u52a1\u540d\u79f0\nservice_name_1:\nimage: mysql:8.0.23\nnetworks:\n- frontend\nnetworks:\nfrontend:  # \u5728\u540c\u4e00\u7f51\u7edc\u4e2d\u7684\u670d\u52a1\u53ef\u901a\u8fc7 \u670d\u52a1\u540d\u6765\u8bbf\u95ee\u3002\nvolumes:\nserver_data:  # \u5bb9\u5668\u5173\u95ed\u540e\u5176\u5185\u90e8\u53d8\u5316\u7684\u6587\u4ef6\u5c06\u4f1a\u4e22\u5931\uff0c volumes \u53ef\u4ee5\u5c06\u5bb9\u5668\u5185\u6587\u4ef6\u540c\u6b65\u5230\u5bbf\u4e3b\u673a\n</code></pre> <p>\u6ce8\u610f\uff1a</p> <ul> <li>service_name \u4e0d\u540c\u4e8e container_name \uff0cdocker-compose \u4f1a\u9ed8\u8ba4\u521b\u5efa\u4ee5<code>\u9879\u76ee\uff08\u5f53\u524d\u76ee\u5f55\uff09_servicename_number</code>\u5f62\u5f0f\u521b\u5efa\u5bb9\u5668\u540d\uff0c\u4e24\u8005\u90fd\u53ef\u4ee5\u4f5c\u4e3a DNS \u522b\u540d\u8fdb\u884c\u7f51\u7edc\u8bbf\u95ee\u3002</li> <li>\u4e0d\u521b\u5efa networks \u7684\u8bdd\uff0c compose \u9ed8\u8ba4\u521b\u5efa\u4e00\u4e2a <code>\u9879\u76ee\u540d\u79f0_default</code> \u7684 bridge \u7c7b\u578b\u7684\u7f51\u7edc\u3002</li> <li>\u5728 v1.27.0 \u4e4b\u524d\uff0c\u9700\u8981\u5728\u6700\u5f00\u59cb\u6dfb\u52a0 version \u6765\u6307\u5b9a\u4e0d\u540c compose \u7248\u672c\u6240\u652f\u6301\u7684 \u6307\u4ee4\u3002</li> </ul> <p>\u4f8b\u5b50</p> YAML<pre><code>version \"3.8\"\nservices:\nweb:\nbuild: ./app\nenvironment:\n- password=123\nnetworks:\n- web-net\nports:\n- 8000:5000\ndepends_on:\n- db\ndb:\nimage: mysql:5.7\nenvironment:\n- password=123\nnetworks:\n- web-net\nnetworks:\nweb-net:  # \u6307\u5b9a\u9ed8\u8ba4\u5f62\u5f0f\uff08bridge\uff09\u521b\u5efa\u7f51\u7edc\n</code></pre> <p>docker compose \u547d\u4ee4\u884c\u5de5\u5177\uff0c\u5fc5\u987b\u5728docker-compose.yml \u6587\u4ef6\u6240\u5728\u76ee\u5f55\u8fd0\u884c\uff0c\u6216\u8005\u5728\u547d\u4ee4\u884c\u52a0\u4e0a <code>-f &lt;\u6307\u5b9acompose.yml\u6587\u4ef6&gt;</code></p> Bash<pre><code># \u542f\u52a8, -d \u540e\u53f0\u8fd0\u884c\ndocker-compose up -d\n\n# \u67e5\u770b\u5bb9\u5668\uff08\u670d\u52a1\uff0cservice\uff09\ndocker-compose ps\n\n# \u505c\u6b62\ndocker-compose stop\n\n# \u5220\u9664\u505c\u6b62\u7684\u670d\u52a1\ndocker-compose rm\n\n# \u628a\u9700\u8981\u6784\u5efa\u7684\u955c\u50cf\u5148 build\ndocker-compose build\n\n# \u542f\u52a8\uff0c\u5e76\u5bf9\u9700\u8981\u91cd\u65b0\u6784\u5efa\u7684\u955c\u50cf\u8fdb\u884c build\ndocker-compose up --build\n# \u542f\u52a8\uff0c\u5e76\u81ea\u52a8\u66f4\u65b0\u914d\u7f6e\u6587\u4ef6\ndocker-compose restart\n#\u542f\u52a8\uff0c\u5e76\u5220\u9664\u4e0d\u9700\u8981\u7684(\u5b64\u513f)\u5bb9\u5668\ndocker-compose up --remove-arphons\n\n# \u67e5\u770b\u914d\u7f6e\u662f\u5426\u6b63\u786e\ndocker-compose config\n\n# \u5220\u9664\u5bb9\u5668\u548c\u5377\ndocker compose down -v\n\n# \u8fd0\u884c\u547d\u4ee4\ndocker compose exec web command\n</code></pre>"},{"location":"docker/#scale","title":"\u6c34\u5e73\u6269\u5c55 scale","text":"<p>\u8ba9\u5bb9\u5668\u53ef\u4ee5\u91cd\u590d\u51fa\u73b0\uff0c\u53ef\u4ee5\u5b9e\u73b0\u7b80\u5355\u7684 web \u670d\u52a1\u5668\u8d1f\u8f7d\u5747\u8861</p> Bash<pre><code># \u53ea\u5b9a\u4e49\u4e00\u4e2a server \u4f46\u662f\u53ef\u4ee5\u542f\u52a8\u591a\u4e2a\u5bb9\u5668\uff0c\ndocker-compose up -scale server_name=number\n</code></pre>"},{"location":"docker/#_2","title":"\u73af\u5883\u53d8\u91cf","text":"<p>\u6307\u5b9asecret\u914d\u7f6e\uff0c\u5728 docker-compose.yml \u540c\u76ee\u5f55\u4e0b\u521b\u5efa .env \u6587\u4ef6\uff0c\u6216\u8005\u4f7f\u7528 <code>docker-compose --env-file &lt;env_path&gt;</code>\u6307\u5b9a\u73af\u5883\u53d8\u91cf\u4f4d\u7f6e\u3002</p> Text Only<pre><code>REDIS_PASSWORD=123\n</code></pre> <p>\u5728docker-compose.yml\u5f15\u7528</p> YAML<pre><code>version: \"3.8\"\nservices:\nweb:\nimage: iamge_name\nenvironment:\n- REDIS_PASSWORD=${REDIS_PASSWORD}\n</code></pre>"},{"location":"docker/#_3","title":"\u5065\u5eb7\u68c0\u6d4b","text":"<p>depends_on \u53ea\u80fd\u4f9d\u8d56\u662f\u5426\u542f\u52a8\u670d\u52a1\uff0c\u4f46\u662f\u4e0d\u80fd\u4fdd\u8bc1\u670d\u52a1\u662f\u5426\u6b63\u5e38\u3002\u7ed3\u5408\u5065\u5eb7\u68c0\u6d4b\u53ef\u4ee5\u66f4\u597d\u7684\u7ef4\u62a4\u542f\u52a8\u3002</p> YAML<pre><code>version: \"3.8\"\nservices:\nweb:\nimage: image\ndepends_on:\nredis\uff1a\ncondition: service_healthy  # \u4f9d\u8d56 healthy\nredis:\nimage: redis:latest\nhealthcheck:  # \u68c0\u67e5\ntest: ['CMD', 'redis-cli', 'ping']\ninterval: 10s  # \ntimeout: 10s  # \u8d85\u65f6\u9650\u5236\nstart_period: 10s\nretries: 3  # \u91cd\u8bd5\u6b21\u6570\n</code></pre> <ul> <li>test \u8981\u6d4b\u8bd5\u7684\u547d\u4ee4</li> <li>interval \u6d4b\u8bd5\u65f6\u95f4\u95f4\u9694</li> <li>timeout \u7b49\u5f85\u54cd\u5e94\u6700\u957f\u65f6\u95f4</li> <li>start_period \u4f55\u65f6\u542f\u52a8\u8fd0\u884c\u72b6\u51b5\u68c0\u67e5</li> <li>retries \u6700\u5927\u91cd\u8bd5\u6b64\u65f6</li> </ul>"},{"location":"docker/#_4","title":"\u4f8b\u5b50","text":"Bash<pre><code>docker network create ---subnet=172.20.0.0/18 backend\n# MySQL\ndocker run -it -d --name mysql_1 -p 12001:3306 \\\n--net backend --ip 172.20.0.2\n-m 400m -v ./data/mysql/data:/var/lib/mysql \\\n-v ./data/mysql/config:/etc/mysql/conf.d \\\n--privileged=true \\\n-e MYSQL_ROOT_PASSWORD=123456 \\\n-e TZ=Asia/Shanghai \\\nmysql:8.0.31 \\\n--lower_case_table_names=1\n# MongoDB\ndocker run -it -d --name mongo \\\n-p 27017:27017 \\\n--net backend --ip  172.20.0.3 \\\n-m 400m \\\n-v ./data/mongo:/etc/mongo \\\n-v ./data/mongo/data/db:/data/db \\\n-e MONGO_INITDB_ROOT_USERNAME=admin \\\n-e MONGO_INITDB_ROOT_PASSWORD=abc123456 \\\n-e TZ=Asia/Shanghai \\\n--privileged=true \\\ndocker.io/mongo \\\n--config /etc/mongo/mongod.conf\n\n# Redis\ndocker run -it -d --name redis \\\n-p 6379:6379 \\\n--net backend --ip 172.20.0.4 \\\n-m 200m \\\n-v ./redis/conf:/usr/local/etc/redis \\\n-e TZ=Asia/Shanghai \\\nredis:7.0.1 \\\nredis-server /usr/local/etc/redis/redis.config\n\n# RabbitMQ\ndocker run -it -d --name mq \\\n-p 5672:5672 \\\n--net backend --ip 172.20.0.5 \\\n-m 500m \\\n-e TZ=Asia/Shanghai --privileged=true \\\nrabbitmq\n</code></pre> <p>\u5176\u4e2d\uff1a</p> Bash<pre><code>## mongod.conf\nnet:\n   port: 27017\nbindIp: \"0.0.0.0\"\nstorage:\n   dbPath: \"/data/db\"\nsecurity:\n   authorization: enabled\n\n## redis.conf\nbind 0.0.0.0\nprotected-mode yes\nport 6379\ntcp-backlog 511\ntimeout 0\ntcp-keepalive 0\nloglevel notice\nlogfile \"\"\ndatabases 12\nsave 900 1\nsave 300 10\nsave 60 10000\nstop-writes-on-bgsave-error yes\nrdbcompression yes\nrdbchecksum yes\ndbfilename dump.rdb\ndir ./\nrequirepass abc123456\n</code></pre>"},{"location":"docker/#reference","title":"Reference","text":"<p>Docker Documentation</p> <p>Docker \u4ece\u5165\u95e8\u5230\u5b9e\u8df5</p> <p>Compose file | Docker Documentation</p> <p>Developing inside a Container using Visual Studio Code Remote Development</p> <p>Docker\u7cfb\u7edf\u6027\u5165\u95e8+\u5b9e\u8df5 - \u6155\u8bfe\u7f51 (imooc.com) \u4e0d\u9519\u7684\u89c6\u9891\u8bfe\u7a0b</p> <p>Docker Tips (Docker\u7b14\u8bb0) \u2014 Docker Tips 0.1 documentation  \u4e0a\u9762\u8bfe\u7a0b\u7684\u8bfe\u4ef6</p> <p>Example Docker Compose app \u5f88\u597d\u7684\u5b66\u4e60\u6837\u677f</p> <p>docker compose health check example \u5b66\u4e60\u6837\u677f2\uff08old\uff09</p> <p>Docker Best Practices for Python Developers |TestDriven.io \u4f18\u79c0\u6559\u7a0b</p> <p>https://testdriven.io/blog/flask-docker-traefik/</p> <p>How to building Minimal Docker Containers for Python Applications --- \u5982\u4f55\u4e3a Python \u5e94\u7528\u7a0b\u5e8f\u6784\u5efa\u6700\u5c0f\u7684 Docker \u5bb9\u5668 (morioh.com) \u5173\u4e8e pip install \u4e0e pip wheel \u533a\u522b</p> <p>Docker \u5bb9\u5668\u4f18\u96c5\u7ec8\u6b62\u65b9\u6848 \u2013 \u4e91\u539f\u751f\u5b9e\u9a8c\u5ba4 (icloudnative.io) \u5bb9\u5668\u505c\u6b62\u9700\u898110 \u79d2\u95ee\u9898\u89e3\u51b3</p>"},{"location":"docs/","title":"Code Documentation Management of Project Workflow","text":"<p>Define</p> <p>Document Type: user documents and development documents.</p> <p>Document Format: comment docstring markdown</p>"},{"location":"docs/#_1","title":"\u5b89\u88c5\u4f9d\u8d56","text":"<ul> <li>mkdocs  markdown doc \u751f\u6210</li> <li>mkdocs-material  mkdocs material style (default google)</li> <li>mkdocstrings[python]  # \u5c06 python \u6587\u6863\u5b57\u7b26\u4e32\u751f\u6210\u6587\u6863</li> <li>mdx-include  # \u53ef\u4ee5\u4f7f\u7528 <code>\\{\\! path \\!\\}</code> \u5f62\u5f0f\u5d4c\u5957 md \u6587\u4ef6</li> </ul>"},{"location":"docs/#_2","title":"\u7f16\u5199\u6587\u6863","text":"Bash<pre><code># \u521b\u5efa mkdocs \u683c\u5f0f\nmkdocs new .\n# \u4f1a\u751f\u6210 docs/index.md \u548c mkdocs.yml\n</code></pre>"},{"location":"docs/#_3","title":"\u914d\u7f6e","text":"mkdocs.yml<pre><code>site_name: Tips\nrepo_url: https://github.com/xiaomoe/tips\nrepo_name: xiaomoe/tips\ntheme:\nname: \"material\"\nlogo: \"\"\nlanguage: zh\npalette:\n- scheme: default\nprimary: pink\naccent: pink\ntoggle:\nicon: material/weather-sunny\nname: Switch to dark mode\n- scheme: slate\nprimary: pink\naccent: pink\ntoggle:\nicon: material/weather-night\nname: Switch to light mode\nfont:\ntext: Open Sans\ncode: Fira Code\nfeatures:\n# - navigation.tabs\n# - navigation.tabs.sticky\n- navigation.top\n- toc.follow\n- search.suggest\n- content.code.copy\n- content.code.annotate\n- content.tabs.link\nplugins:\n- mkdocstrings:\nhandlers:\npython:\noptions:\ndocstring_style: google\n- search:\nlang:\n- en\nseparator: '[\\s\\u200b\\-]'\n- glightbox\nnav:\n- Tips: index.md\n- Development:\n# - Project Structure: structure.md\n- Docker Service: docker.md\n- Workflow:\n- Code Qulity: code_quality.md\n- Documentation: docs.md\n- Git: git.md\n- \u73af\u5883\u53d8\u91cf: env.md\nmarkdown_extensions:\n- admonition\n- pymdownx.details\n- pymdownx.superfences\n- pymdownx.highlight:\nlinenums: true\nanchor_linenums: true\nauto_title: true\n- pymdownx.inlinehilite\n- pymdownx.snippets\n- pymdownx.tabbed:\nalternate_style: true\n- tables\n- attr_list\n- md_in_html\n- pymdownx.emoji\n- toc:\npermalink: \"#\"\n</code></pre>"},{"location":"docs/#md","title":"md \u6587\u6863","text":"<p>docs \u6587\u4ef6\u5939\u4e0b\u5c31\u662f\u7f16\u5199\u7684 md \u6587\u6863\uff0c\u7f16\u5199\u540e\u5728 <code>mkdocs.yml</code> \u6587\u4ef6\u7684 <code>nav</code> \u6807\u7b7e\u4e0b\u5f15\u7528\u5373\u53ef\u3002</p>"},{"location":"docs/#pep257-docstrings","title":"PEP257-docstrings \u6587\u6863","text":"<p>\u5728 yml \u6587\u4ef6\u4e2d\u52a0\u5165 <code>plugins</code> \u914d\u7f6e\uff1a YAML<pre><code>plugins:\n- mkdocstrings\n</code></pre></p> <p>\u4f7f\u7528 docstring \u5728 docs/ \u4e0b\u7684 markdown \u6587\u4ef6\u4e2d\u4f7f\u7528 <code>package.module</code> \u81ea\u52a8\u5f15\u5165\u6587\u6863\u5b57\u7b26\u4e32</p> <p>\u5f15\u5165\u4e00\u4e2a python \u6587\u4ef6</p> <p>\u914d\u5408\u63d2\u4ef6</p>"},{"location":"docs/#todo","title":"TODO","text":""},{"location":"docs/#_4","title":"\u542f\u52a8","text":""},{"location":"docs/#_5","title":"\u672c\u5730\u542f\u52a8","text":"Bash<pre><code>mkdocs serve\n</code></pre>"},{"location":"docs/#_6","title":"\u90e8\u7f72","text":"Bash<pre><code>mkdocs build\n# \u521b\u5efa site/ \u6587\u4ef6\u5939\n# github \u652f\u6301\u5728\u4ed3\u5e93\u4e2d\u521b\u5efa gh-pages \u5206\u652f\u6765\u63d0\u4f9b\u5728\u7ebf\u6587\u6863\uff0cmkdocs \u96c6\u6210\u4e86\u64cd\u4f5c\uff0c\u76f4\u63a5\nmkdocs gh-deploy\n# \u8be5\u547d\u4ee4\u4f1a\u81ea\u52a8build \u5e76\u5c06\u7ed3\u679c\u63a8\u9001\u5230\u7ed1\u5b9a\u7684github \u4ed3\u5e93\u4e0b\u7684 gh-pages \u5206\u652f\u4e0b\n# \u7f51\u5740\u662f\uff1attps://username.github.io/project-name/\n</code></pre>"},{"location":"docs/#reference","title":"Reference","text":"<p>Documenting Python Code and Projects</p> <p>Build Your Python Project Documentation With MkDocs</p>"},{"location":"env/","title":"\u73af\u5883\u53d8\u91cf","text":""},{"location":"env/#_1","title":"\u914d\u7f6e\u9879","text":"<p>\u901a\u5e38\u4e00\u4e2a web \u670d\u52a1\u5668\u4e0d\u6b62\u6709 web app\uff0c\u8fd8\u9700\u8981\u6570\u636e\u5e93\u3001\u4efb\u52a1\u961f\u5217\u3001\u6d88\u606f\u961f\u5217\u3001websocket\u7b49\uff0c\u4ed6\u4eec\u4e2d\u6709\u4e9b\u914d\u7f6e\u662f\u91cd\u53e0\u7684\u6709\u4e9b\u662f\u72ec\u6709\u7684\uff0c\u672c\u6587\u7684\u76ee\u7684\u5373\u80fd\u5728\u4e00\u4e2a\u5730\u65b9\u7ba1\u7406\u6240\u6709\u53d8\u91cf\uff08\u914d\u7f6e\u9879\uff09\u3002</p> <p>\u5c06\u53d8\u91cf\u62bd\u8c61\u4e3a\u4e0e\u4efb\u4f55 <code>app</code> \u65e0\u5173\u7684\u5355\u72ec <code>module</code>\uff0capp \u53ef\u4ee5\u662f web app\u3001task app\u3001websocket app\u3001DB(Docker) app \u7b49\u3002</p>"},{"location":"env/#production-or-development","title":"\u5982\u4f55\u533a\u5206 production or development","text":"<p>\u5f00\u53d1\u548c\u90e8\u7f72\u53d8\u91cf\u663e\u7136\u9700\u8981\u533a\u5206\uff0c\u73b0\u6709\u7684\u65b9\u6848\u6709\uff1a</p> <ul> <li>\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e0d\u540c\u524d\u7f00</li> <li>\u4e0d\u540c\u6587\u4ef6\u5b9a\u4e49\u76f8\u540c\u53d8\u91cf</li> </ul> <p>\u4e0d\u540c\u6587\u4ef6:</p> <ul> <li>\u9700\u8981\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf STATE \u6765\u63a7\u5236\u52a0\u8f7d\u54ea\u4e2a\u6587\u4ef6\u3002</li> <li>\u6e05\u6670\u533a\u5206\u4e24\u79cd\u72b6\u6001\u3002</li> <li>\u53d8\u91cf\u540d\u79f0\u4e0d\u81f3\u4e8e\u8fc7\u957f\u3002</li> </ul> <p>\u4e24\u79cd\u524d\u7f00\uff1a\u5982 PROD_ or DEV_ \u8fd9\u79cd\u5728\u4e00\u4e2a\u6587\u4ef6\u5185</p> <ul> <li>\u4e5f\u9700\u8981\u6307\u5b9a\u4e00\u4e2a\u5168\u5c40\u53d8\u91cf STATE \u786e\u5b9a\u5f53\u524d\u8fd0\u884c\u72b6\u6001\u3002</li> <li>\u4e0d\u7528\u6765\u56de\u5207\u6362\u6587\u4ef6\u8fdb\u884c\u8f93\u5165\uff0c\u786e\u4fdd\u53d8\u91cf\u6ca1\u6709\u4e22\u5931\u3002</li> <li>\u51cf\u5c11\u914d\u7f6e\u6587\u4ef6\u6570\u91cf\u3002</li> </ul> <p>\u6700\u540e\u9009\u62e9\u591a\u6587\u4ef6\u652f\u6301\uff0c\u5728\u5f00\u53d1\u65f6\u80fd\u591f\u4e13\u6ce8\u5f00\u53d1\u73af\u5883\uff0c\u4e0d\u81f3\u4e8e\u6df7\u4e71\u3002</p> <ul> <li>.env      # Common variables</li> <li>.env.dev  # Development variables</li> <li>.env.prod # Production variables</li> </ul> <p>TODO: \u5927\u591a\u6570 app \u90fd\u6709\u81ea\u52a8\u52a0\u8f7d .env \u7684\u7279\u6027\uff0c\u4e14\u6709\u4e9b\u5728\u52a0\u8f7d env \u6587\u4ef6\u65f6\u53ea\u80fd\u52a0\u8f7d\u4e00\u4e2a\uff0c\u6240\u4ee5\u73b0\u5728\u5b9e\u9645\u4f7f\u7528\u4e86 <code>.env.dev</code> \u548c <code>.env.prod</code> \u4e24\u4e2a\u6587\u4ef6\uff0c<code>.env</code> \u53ef\u80fd\u540e\u671f\u4f1a\u53d8\u6210 dev \u4e13\u5c5e\uff0c\u4ece\u800c\u53bb\u6389 <code>env.dev</code>\u3002</p> <p>\u8b66\u544a</p> <p>env \u6587\u4ef6\u4e0d\u8981\u52a0\u5165\u516c\u5f00\u4ed3\u5e93\u3002</p>"},{"location":"env/#env","title":".env \u5185\u5bb9","text":"<p>\u7edf\u4e00\u653e\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u4e0d\u540c APP \u8bbe\u7f6e\u4e0d\u540c\u524d\u7f00\u3002\u5168\u90e8\u5927\u5199\u3002</p> <p>\u6bd4\u5982\uff1a</p> <ul> <li>CELERY_</li> <li>WEB_</li> <li>MYSQL_</li> <li>REDIS_</li> <li>COMPOSE_</li> <li>SMS_</li> <li>COS_</li> </ul> <p>.env.dev \u4e0e .env.prod \u4e00\u822c\u6210\u5bf9\u51fa\u73b0\u3002</p>"},{"location":"env/#common-and-secret","title":"Common and Secret","text":"<ul> <li>.env \u7b49\u6587\u4ef6\u8981\u59cb\u7ec8\u4fdd\u6301\u6392\u9664\u5728\u516c\u5f00\u5e93\u7684\u7248\u672c\u63a7\u5236\u4e4b\u5916\u3002</li> <li>.env.prod \u4e2d\u5c06\u79c1\u5bc6\u9879\u53bb\u6389\uff0c\u5728 shell \u4e2d\u6307\u5b9a\u3002\uff08\u5927\u90e8\u5206 app \u652f\u6301 \u53d8\u91cf\u4f18\u5148\u7ea7 shell \u9ad8\u4e8e env \u6587\u4ef6\uff09</li> </ul>"},{"location":"env/#app","title":"app \u5982\u4f55\u4f7f\u7528\u73af\u5883\u53d8\u91cf","text":"<p>\u5927\u81f4\u53ef\u5206\u4e3a\u4e24\u7c7b Python \u76f8\u5173 app\uff0c\u548c\u975e Python \u76f8\u5173\u3002</p> <ul> <li>\u5982\u679c Python \u76f8\u5173\uff0c\u5982 web app\u3001websocket app\u3001Celery app \u7b49\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 pydantic\uff08<code>config.Config</code>\uff09</li> <li>\u975e Python \uff0c\u5982 Docker \u8fd0\u884c\u7684 Mysql/Redis\uff0c\u5219\u9700\u8981\u76f4\u63a5\u8bfb\u53d6 .env\u3001.env.prod/.env.dev\u3002</li> </ul>"},{"location":"env/#_2","title":"\u5f00\u53d1\u73af\u5883","text":"<ol> <li>Web app (Flask)</li> </ol> Bash<pre><code># use flask\nflask --env-file .env.dev --debug run\n\n# or use pdm\npdm run dev\n# dev = \"flask --env-file .env.dev --debug run\"\n</code></pre> <ol> <li>Mysql \u6216\u8005\u5176\u4ed6 Docker \u8fd0\u884c\u7684\u670d\u52a1</li> </ol> Bash<pre><code>docker compose --env-file .env.dev up --build &lt;service name&gt;\n</code></pre> <p>\u6216\u8005\u76f4\u63a5\u5168\u90e8 Docker \u542f\u52a8</p> Bash<pre><code>docker compose --env-file .env.dev up --build\n\n# or\npdm run docker\n</code></pre>"},{"location":"env/#_3","title":"\u751f\u4ea7\u73af\u5883","text":"<p>web app \u4f7f\u7528 gunicorn</p> Bash<pre><code>docker compose --env-file .env.prod -f compose.prod.yaml up --build -d\n# or\npdm run prod\n</code></pre>"},{"location":"git/","title":"Commonly used Git Commands of Project Workflow","text":"<p>\u7248\u672c\u63a7\u5236\u548c\u534f\u540c\u5f00\u53d1\u3002</p> <p>\u82b1\u52a8\u4eea\u5bb9\u7389\u6da6\u989c\uff0c\u6e29\u67d4\u5a40\u5a1c\u8d81\u6e05\u95f2\uff0c\u76c8\u76c8\u9189\u773c\u6a2a\u79cb\u6c34\uff0c\u6de1\u6de1\u5ce8\u7709\u62b9\u8fdc\u5c71\u3002</p>"},{"location":"git/#_1","title":"\u521d\u59cb\u914d\u7f6e","text":"LinuxWindows \u672c\u5730\u7528\u6237<pre><code>git config --global user.name \"username\"\ngit config --global user.email \"your_email@example.com\"\ngit config --global init.defaultbranch \"main\"\n</code></pre> Text Only<pre><code># \u53e6\u52a0 \u542f\u7528 autocrlf\ngit config --global core.autocrlf input\n</code></pre> <p>SSH \u8ba4\u8bc1</p> ed25519rsa <pre><code># \u751f\u6210\u5bc6\u94a5\nssh-keygen -t ed25519 -C \"your_email@example.com\"\n# \u6dfb\u52a0\u5230 ssh-agent\neval \"$(ssh-agent -s)\"  # \u5f53\u524d Shell \u542f\u52a8\nssh-add ~/.ssh/id_ed25519  # \u6dfb\u52a0\u5bc6\u94a5\ncat ~/.ssh/id_ed25519.pub\n# \u628a\u8f93\u51fa\u5185\u5bb9\u590d\u5236\u5230 gitee github\n# \u6d4b\u8bd5\nssh -T git@host -p port\n</code></pre> <pre><code># \u751f\u6210\u5bc6\u94a5\nssh-keygen -t rsa -b 4096 -C \"your_email@example.com\"\n</code></pre>"},{"location":"git/#_2","title":"\u9879\u76ee\u5f00\u59cb","text":"\u672c\u5730\u5f00\u59cb\u8fdc\u7a0b\u83b7\u53d6 Bash<pre><code>git init\ngit remote add origin git@github.com:&lt;username&gt;/&lt;project&gt;.git\ngit fetch orign\ngit branch --set-upstream-to=origin/main main\ngit pull origin main --rebase\n# git add git commit git push\n</code></pre> Bash<pre><code>git clone git@github.com:&lt;username&gt;/&lt;project&gt;.git [local_name]\n</code></pre>"},{"location":"git/#_3","title":"\u5e38\u7528\u64cd\u4f5c","text":""},{"location":"git/#_4","title":"\u672c\u5730\u6570\u636e\u540c\u6b65\uff08\u6d41\u52a8\uff09","text":"<p><code>add</code> <code>commit</code> <code>restore</code></p> <p></p> Bash<pre><code>#### \u653e\u5f03\u672c\u5730\u4fee\u6539\ngit restore &lt;file&gt;\n\n#### \u653e\u5f03\u63d0\u4ea4\u6682\u5b58\u53bb\u6570\u636e\ngit restore --staged &lt;file&gt;\n# \u6216\u8005\u5f53\u524d\u8fd8\u6ca1\u6709\u672c\u5730 commit \u65f6\u4f7f\u7528\ngit rm --cached &lt;file&gt;\n\n#### \u6062\u590d\u67d0\u4e2a\u5386\u53f2\u533a commit \u5230\u672c\u5730\u548c\u6682\u5b58\u533a\ngit restore --source=&lt;commit_id&gt; --staged --worktree &lt;file&gt;\n\n#### \u8ffd\u52a0 commit\uff0c\u5c0f\u7684\u4fee\u6539(\u4e0d\u4f1a\u4ea7\u751f\u65b0\u7684 commit)\ngit commit --amend --no-edit\n</code></pre>"},{"location":"git/#_5","title":"\u5386\u53f2\u533a\u53ca\u5206\u652f\u64cd\u4f5c","text":"<p><code>switch</code> <code>rebase</code> <code>branch</code></p> <p>\u6bcf\u6b21\u7684 commit \u64cd\u4f5c\u90fd\u4f1a\u5728\u5386\u53f2\u533a\u751f\u6210\u4e00\u4e2a\u5feb\u7167\u5e76\u52a0\u5165\u5230\u94fe\u5f0f\u7ba1\u7406\uff0c\u6bcf\u4e2a\u5feb\u7167\u90fd\u6709 id\uff0c\u53ef\u4ee5\u79f0\u4e3a commit\u3002</p> <ul> <li>branch \u5c31\u662f\u67d0\u4e00\u4e2a\u94fe\u6761\uff08\u5e76\u6307\u5411\u94fe\u6761\u7684\u6700\u65b0\u7684 commit\uff09\u3002</li> <li>main \u662f\u67d0\u4e00\u4e2a branch\uff0c\u5728 github \u7b49\u4ed3\u5e93\u4e2d\u4f5c\u4e3a\u4e3b\u5206\u652f\u3002</li> <li>HEAD\u8868\u793a\u5f53\u524d commit\uff0c\u968f\u7740\u63d0\u4ea4\u4e0d\u65ad\u5411\u524d\u3002</li> <li>tag \u4e5f\u662f\u6307\u5411\u67d0\u4e00\u4e2a commit\uff0c\u5e76\u6c38\u4e45\u4e0d\u52a8\u3002</li> </ul> <p>\u53ef\u4ee5\u7406\u89e3\u4e3a\uff1a\u6240\u6709\u5386\u53f2\u533a\u64cd\u4f5c\u64cd\u4f5c\u7684\u90fd\u662f commit\uff0c\u53ea\u4e0d\u8fc7\u6709\u7684 commit \u6709\u522b\u79f0\u3002</p> <p></p> \u5207\u6362\u5206\u652f\u5220\u9664\u5206\u652f\u5408\u5e76\u5206\u652f\u5408\u5e76commit Bash<pre><code># \u4ece main \u521b\u5efa\u4e00\u4e2a\u5206\u652f\u5e76\u5207\u6362\ngit switch -c &lt;branch_name&gt; main\n# \u4ece\u8fdc\u7a0b\u5206\u652f\u521b\u5efa\ngit switch -c &lt;branch_name&gt; origin/main\n\n# \u67e5\u770b\u6240\u6709\u5206\u652f\ngit branch -a\n</code></pre> Bash<pre><code>git switch main\ngit branch -D &lt;branch_name&gt;\n# \u5220\u9664\u8fdc\u7a0b\u5206\u652f\ngit push origin -d &lt;branch_name&gt;\n</code></pre> Bash<pre><code>git switch main\ngit merge dev\n</code></pre> Bash<pre><code># \u5408\u5e76\u591a\u4e2a commit -i \u4ea4\u4e92\u5f0f\u9009\u62e9 \u5c06 pick \u6539\u4e3a squash\ngit rebase -i HEAD~X\n</code></pre> <p>Tip</p> <p><code>&lt;file&gt;</code> \u53ef\u4ee5\u66ff\u6362\u4e3a <code>.</code> \u8868\u793a\u5f53\u524d\u76ee\u5f55\u6240\u6709\u6587\u4ef6</p>"},{"location":"git/#reference","title":"Reference","text":"<p>Git Bootcamp and Cheat Sheet</p> <p>How to change my Git username in terminal? </p> <p>using-multiple-github-accounts-with-ssh-keys</p> <p>Git \u7684\u5947\u6280\u6deb\u5de7</p> <p>git-restore - \u6062\u590d\u5de5\u4f5c\u6811\u6587\u4ef6</p> <p>git-rebase - Reapply commits on top of another base tip</p>"}]}